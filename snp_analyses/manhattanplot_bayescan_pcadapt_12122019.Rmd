---
title: "ManhattanPlot_Bayescan_PCAdapt_12122019"
author: "Hannah Reich"
date: "12/12/2019"
output: html_document
---

```{r warning=FALSE, message=FALSE}
# dec 12 2019
# attempting to make a better manhattan plot that combines results from bayescan and pcadapt
# script modified from "Garcia_AcervPopGenReport" (From Dr. Sheila Kitchen)

# load a zillion packages
library(reshape2)
library(pcadapt)
library(qvalue)
library(dplyr)
library(tidyverse)
library(boa)
library(vcfR)
library(gghighlight)
library(qqman)
library(cowplot)
```


```{r}
setwd("~/Desktop/PhD/Symbiodinium fitti/SNP_under_selection/v_contam_rm_08082019/")


c <- read.table("PCADAPT_ALLvalues.txt", header=T)
# read in the bayescan results
b <- read.table("alloutlier_BAYESCAN_stats.txt", header=T)

outliers<- c  %>%
  mutate(PCA_outlier = ifelse(PCA.q.val < 0.05, "TRUE", "FALSE")) %>%
 # mutate(PCA_pc1 = ifelse(out2$ID %in% snp_pc1$SNP, snp_pc1$PC, "FALSE")) %>%
  left_join(b %>% select("BAYES_qval","BAYES_fst", "ID"), by=c("ID")) %>%
  mutate(BAYES_outlier = ifelse(ID %in% b$ID, "TRUE", "FALSE")) 
#separate(LocusName, into = c("chrom", "pos"), sep="_(?=[^_]+$)")


# ggplot version https://www.r-graph-gallery.com/101_Manhattan_plot.html, https://cran.r-project.org/web/packages/qqman/vignettes/qqman.html
# do this eventually https://github.com/sahirbhatnagar/manhattanly

qv <- ggplot(outliers, aes(x=ID, y=-log10(PCA.q.val))) +
  geom_point(alpha=0.8, color = "#999999", size=2) +
  geom_point(data=subset(outliers, PCA_outlier=="TRUE"), mapping=aes(color = "#56B4E9"), size = 0.8) +
    geom_point(data=subset(outliers, BAYES_outlier=="TRUE" & PCA_outlier=="TRUE"), mapping=aes(color="#D55E00"), size=2) +
    geom_point(data=subset(outliers, BAYES_outlier=="TRUE"), mapping=aes(color="#F0E442"), size=0.8) +
  theme_bw() +
  labs(x="SNP ID #", y="-log10(q-value)") +
  theme(legend.position = "bottom",
        axis.text = element_text(size=12),
        axis.title = element_text(size=14, face = "bold"),
        legend.text = element_text(size=10),
        legend.title = element_text(size=12, face = "bold")) +
  scale_colour_manual(values = c("#56B4E9", "#F0E442", "#D55E00"),
                      labels = c("PCAdapt", "BayeScan", "Both"), name = c("Outlier Type")) 
qv

qv_zoom <- qv +
  ylim(0,2) +
  theme(legend.position = "none",
        axis.title=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        plot.background = element_blank()) 
qv_zoom

# put the zoomed in part in the top right
total <- ggdraw() +
  draw_plot(qv) +
  draw_plot(qv_zoom, x=.75, y=.77, width = .25, height = .23)
total

ggsave("manhattanplot_total.png", total)
ggsave("~/Desktop/PhD/chapters/chapter 3 - fitti/Figs_jan_2020/Fig_5_manhattanplot_total.pdf", total, height = 5, width = 8, units = "in")


```

